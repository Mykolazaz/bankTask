---
title: "Data Manipulation Task"
output: pdf_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Packages

```{r message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
```

## Importing data

```{r}
bank_full <- read_delim("bankData/bank-full.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
```

## Data cleaning

```{r}
head(bank_full)
```

A first look at the data shows us that many of the provided columns have an incorrect data type. For example, default and marital status are set as character data types when they should be factors.

```{r}
str(bank_full)
```

A look at the description by the researchers tells us that there are no missing values even though some columns have values "unknown". They should be changed to NA.

```{r}
bank_full[bank_full == "unknown"] <- NA

bank_full <- bank_full %>%
  mutate(job = if_else(job == "admin.", "admin", job)) %>% 
  mutate(across(c(marital, job, education, contact), as.factor)) %>% 
  mutate(across(c(default, housing, loan, y), ~ .x == "yes"))

str(bank_full)
```

Now the data is cleaned and we may begin working with it.

## Manipulating data

We select a small sample of the provided data with a pre-determined seed for repeatable results.

```{r}
set.seed(167)
smallBank <- sample_n(bank_full, 400, replace = FALSE)
```

```{r}
summary(bank_full[, c("age", "job", "marital", "education", "default", "loan")])
```

Let's take a closer look at the clients which have a dangerously low balance and have or have had a partner at a point in their life. Due to low numbers in the total population, let's search for them in the full data set.

```{r}
lowBalwPartner <- bank_full %>% 
  filter(balance < 100 & marital %in% c("maried", "divorced"))
```

Also, we'll choose another group of clients which have at least one loan with the bank.

```{r}
withLoans <- bank_full %>% 
  filter(housing == TRUE | loan == TRUE)
```

Next, we can drop columns that we will no longer need.
